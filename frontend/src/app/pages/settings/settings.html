<div class="settings-page" *transloco="let t; prefix: 'pages.settings'">
  @if (loading()) {
    <div class="loading-spinner">
      <mat-spinner diameter="48"></mat-spinner>
    </div>
  } @else {
    <form [formGroup]="configForm" (ngSubmit)="saveConfig()">
      <div class="pipeline-flow">

        <!-- Krok 1: Predspracovanie -->
        <section class="pipeline-step step-1">
          <div class="step-rail">
            <div class="step-badge">1</div>
            <div class="step-connector"></div>
          </div>
          <div class="step-card">
            <div class="step-header">
              <mat-icon class="step-header-icon">filter_alt</mat-icon>
              <h2>{{ t('preprocessing') }}</h2>
            </div>
            <div class="step-body">
              <div class="form-grid">
                <mat-form-field >
                  <mat-label>{{ t('minLat') }}</mat-label>
                  <input matInput type="number" formControlName="minLat" step="0.1" />
                  <mat-hint>-90 {{ t('to') }} 90</mat-hint>
                </mat-form-field>

                <mat-form-field >
                  <mat-label>{{ t('maxLat') }}</mat-label>
                  <input matInput type="number" formControlName="maxLat" step="0.1" />
                  <mat-hint>-90 {{ t('to') }} 90</mat-hint>
                </mat-form-field>

                <mat-form-field >
                  <mat-label>{{ t('minLon') }}</mat-label>
                  <input matInput type="number" formControlName="minLon" step="0.1" />
                  <mat-hint>-180 {{ t('to') }} 180</mat-hint>
                </mat-form-field>

                <mat-form-field >
                  <mat-label>{{ t('maxLon') }}</mat-label>
                  <input matInput type="number" formControlName="maxLon" step="0.1" />
                  <mat-hint>-180 {{ t('to') }} 180</mat-hint>
                </mat-form-field>

                <mat-form-field >
                  <mat-label>{{ t('maxSpeedKmh') }}</mat-label>
                  <input matInput type="number" formControlName="maxSpeedKmh" step="10" />
                  <mat-hint>km/h</mat-hint>
                </mat-form-field>
              </div>
            </div>
          </div>
        </section>

        <!-- Krok 2: H3 Spatial Index -->
        <section class="pipeline-step step-2">
          <div class="step-rail">
            <div class="step-badge">2</div>
          </div>
          <div class="step-card">
            <div class="step-header">
              <mat-icon class="step-header-icon">hexagon</mat-icon>
              <h2>{{ t('h3SpatialIndex') }}</h2>
            </div>
            <div class="step-body">
              <div class="form-grid">
                <mat-form-field >
                  <mat-label>{{ t('h3DedupResolution') }}</mat-label>
                  <input matInput type="number" formControlName="h3DedupResolution" min="0" max="15" step="1" />
                  <mat-hint>{{ t('h3ResolutionHint') }}</mat-hint>
                </mat-form-field>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Akčné tlačidlá -->
      <div class="action-bar">
        <button mat-flat-button type="submit" [disabled]="saving() || configForm.invalid" class="save-btn">
          @if (saving()) {
            <mat-spinner diameter="20"></mat-spinner>
          } @else {
            <mat-icon>save</mat-icon>
          }
          {{ t('save') }}
        </button>
        <button mat-stroked-button type="button" (click)="resetToDefaults()" [disabled]="saving()">
          <mat-icon>restart_alt</mat-icon>
          {{ t('resetToDefaults') }}
        </button>
      </div>
    </form>
  }
</div>
